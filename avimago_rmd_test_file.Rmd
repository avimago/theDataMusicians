---
title: "Factors Impacting Employee Satisfaction"
author: Hai Wen Chen, Avi Mago, William Marshall, Haochen Song, Siddharth Srinivasan
  Swamy, Xuying Zhong
date: "September 25, 2017"
output:
  html_document:
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
---
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
IBM <- read.csv("WA_Fn-UseC_-HR-Employee-Attrition.csv")
colnames(IBM)[1] <- "Age"
IBM <- select(IBM, Age:EducationField, EnvironmentSatisfaction:NumCompaniesWorked, OverTime:RelationshipSatisfaction, StockOptionLevel:YearsWithCurrManager)
```
# Introduction
## The relationship between Attrition and Total Satisfaction
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)

IBM <-  mutate(IBM, TotalSatisfaction=EnvironmentSatisfaction+JobSatisfaction+RelationshipSatisfaction+WorkLifeBalance)

library(ggplot2)
Att_TotalSat <- select(IBM, Attrition, TotalSatisfaction)
ggplot(Att_TotalSat,aes(x=Attrition, y=TotalSatisfaction))+geom_boxplot()
```

# Dataset Description and Descriptive Statistics
This dataset described the employees of IBM, providing a total of 1470 observations (employees) and 35 variables (information about the employee). In our analysis, the colomns EmployeeCount and EmployeeNumber are not useful, and the value in Over18 and StandardHour are the same with all employees (Yes and 80 respectively), so we got rid of thses four colomns to make our analysis more efficient. Meanwhile, we added a new colomn called "TotalSatisfaction", which is the sum of EnvironmentSatisfaction,JobSatisfaction,RelationshipSatisfaction and WorkLifeBalance. In addition, the Education colomn uses integer between 1 to 5 to refer to the level of education of this employee, they mean below college, college, bachelor, master, doctor respectively. To catogrize the education level, we change the integer incicating the level in to factor. We did the same thing to JobLevel, StockOptionLevel and TrainingTimeLastYear. Then the variables can be divided into three groups: Personal Information, Job Information, Satisfaction to the Job in Total.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
personal <- data.frame(Variable=c("Age", "DistanceFromHome", "Education",
                                   "EducationField", "Gender", "MaritalStatus",
                                   "NumCompaniesWorked","TotalWorkingYears"),
                       Type=c("integer","integer","factor","factor","factor","factor","integer","integer"),
                       Description=c("The Employee's age", 
                                     "The distance from home to work", 
                                     "Level of education (1 'Below College', 2 'College', 3 'Bachelor', 4 'Master', 5 'Doctor')",
                                     "The subject of the employee's education (Human Resources, Life Sciences, Marketing, Medical, Other, Technical Degree)", 
                                     "Gender of this employee", "Marital status of this employee (Divorced, Married, Single)",
                                     "The number of companies this employee has worked", "Total number of years this employee has worked since graduation"))

kable(personal, caption = "Personal Information")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
jobinfo <- data.frame(Variable=c("Attrition","BusinessTravel","DailyRate","Department","HourlyRate","JobInvolvement",
                                 "JobLevel","JobRole", "MonthlyIncome", "MonthlyRate", "OverTime", "PercentSalaryHike",
                                 "PerformanceRating","StockOptionLevel", "TrainingTimesLastYear","YearsAtCompany",
                                 "YearsInCurrentRole", "YearsSinceLastPromotion","YearsWithCurrManager"),
                      Type=c("factor","factor","integer","factor","integer","factor","factor","factor","integer","integer",
                             "factor","integer","integer","factor","factor","integer","integer","integer","integer"),
                      Description=c("If this employee left the company", "The frquency of business travel", "sth", 
                                    "The department of this employee (Human Resource, Research & Development and Sales)","sth","1 'Low', 2 'Medium', 3 'High', 4 'Very High'","The level of this employee's job","The position of this employee (Sales Executive, Research Scientist, Laboratory Technician, Manufacturing Director, Healthcare Representative, Manager, (Other))", "The salary of this employee","sth", "If this employee works over time (Yes, No)", "The percentage of salary hike", "1 'Low', 2 'Good', 3 'Excellent', 4 'Outstanding'", "The amount of stock this employee process", "The length of training the employee took last year", "The number of years this employee has been in the company", "The number of years this employee has been in this position","The number of years since last promotion", "The number of years this employee has been with current manager"))

kable(jobinfo, caption = "Job Information")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
totals <- data.frame(Variable=c("EnvironmentSatisfaction","JobSatisfaction","RelationshipSatisfaction","WorkLifeBalance",
                                "TotalSatisfaction"),
                     Type=c("integer","integer","integer","integer","integer"),
                     Description=c("Satisfaction to the environment (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "Satisfaction to the job (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "Satisfaction to the relationship (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "The work life balance rate (1 'Bad', 2 'Good', 3 'Better', 4 'Best')",
                                   "The sum of EnvironmentSatisfaction,JobSatisfaction,RelationshipSatisfaction and WorkLifeBalance "))
kable(totals, caption = "Satisfaction to the Job in Total")
```





# Hypothesis 

# Method 

<<<<<<< HEAD
=======
# Analysis

#Converting variables into Factor Variables
IBM$Education<-ordered(IBM$Education,levels=c("1","2","3","4","5"))
IBM$JobSatisfaction<-ordered(IBM$JobSatisfaction,levels=c("1","2","3","4"))
IBM$JobLevel<-ordered(IBM$JobLevel,levels=c("1","2","3","4"))
IBM$JobInvolvement<-ordered(IBM$JobInvolvement,levels=c("1","2","3","4"))
IBM$JobLevel<-ordered(IBM$Joblevel,levels=c("1","2","3","4","5"))
IBM$StockOptionLevel<-ordered(IBM$StockOptionLevel,levels=c("0","1","2","3"))
IBM$TrainingTimesLastYear<-ordered(IBM$TrainingTimesLastYear,levels=c("0","1","2","3","4","5","6"))
IBM$RelationshipSatisfaction<-ordered(IBM$RelationshipSatisfaction,levels=c("1","2","3","4"))
IBM$WorkLifeBalance<-ordered(IBM$WorkLifeBalance,levels=c("1","2","3","4"))


#Plots
In this part, we are going to plot graphs between attrition and other different factors in order to explore their relationships and further understand which factor actually affect employees' choice on Attrition.

##Training Time Last Year (Yes vs No)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=TrainingTimesLastYear,fill=Attrition))+geom_bar(position="fill")
```

The bar chart above shows a roughly decreasing trend between the training time and the amount of attrition, the longer training time leads to fewer attrition. In addition, about 75 percent of employees keep stay at the company without being affected by this factor. 

##Job Satisfaction (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=JobSatisfaction,fill=Attrition))+geom_bar(position="fill")
```
Similar to traing time, JobSatisfaction is also a factor that influece people's decision on whether to leave or not. As job satisfaction increases from 1 to 4, the percentage of attrition decreases from 24% to 10%, which indicates improving job satisfaction may help prevent employees from leaving the company.

##Department wise Attrition (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=Department,fill=Attrition))+geom_bar(position="fill")
```
Based on the above bar chart, it can be concluded that Research & Development department is the most stable department with only around 14% of employees leaving, while the proporion in Sales and Human Resources Departments are about 10% higher than it.We can mainly focus on this two departments' analysis if the company do not have enough money for improvement.


##Monthly Income Density (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=MonthlyIncome,fill=Attrition))+geom_density(alpha=0.55)
```

As we can see from this density plot on monthly income, it is highly right skewed, which implies most employees' incomes are aound 2500 per month. There is a sharp decrease after the peak reached at 2500, additionally, the density of employees who choose to leave is higher than who want stay when their salary are lower than 4000($). 

##Years At Company Density (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=YearsAtCompany,fill=Attrition))+geom_density(adjust=1.5, position="fill")
```

In term of years employees have stayed at company, the percentage of attrition smoothly goes down during the first 20 years.However, in the following 20 years, it then inscreases to around 90 percent with fluctuations in between. To sum up, People are more likely to leave the company during the first few years or after staying for more than 30 years.

##Years Since Last Promotion (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=YearsSinceLastPromotion,fill=Attrition))+geom_bar(position="fill")
```

The bar chart above shows there is no significant relationship between years since last promotion and the attrition. The propotion for leaving fluctuates around 20 percent.Two special years occur at year 8 and 12 with no attrion.

##Business Travel (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=BusinessTravel,fill=Attrition))+geom_bar(position="fill")
```

In this business travel bar chart, only 8 percent of employees want to leave company if they are in non-travel roles, but high attrition occurs at about 25 percent when they need travel frequently, which indicates that business travel may have positive impact on company's attrition.

##Work Life Balance (Y vs N)
```{r,echo=FALSE,message=FALSE}
ggplot(IBM,aes(x=WorkLifeBalance,fill=Attrition))+geom_bar(position="fill")
```

In terms of work life balance, around 30 percent of employees choose to leave the company if they have a bad balance. However with the level increases to 2 and more, the attrition percentage drops dramatically to half of level 1. Therefore, improvement of work life balance can also be a significant factor.

##Colusion for Attrition plot analysis

So far we have plotted eight graphs aiming to find out the relationship between attrition and each other variables. From the analysis above, we can see JobSatisfaction, BusinessTravel and WorkLifeBalance are three most significant factors that have strong impact on employees attrition choices. 

However, since JobSatisfaction (distrete) and WorkLifeBalance (discrete) are all subset of TotalSatisfaction, we can combined them together as a combined satisfaction (continues variable) and continue exploring which factors affect them through correlation test, in order to find out potential variables that indirectly affect attriton.


# Correlation Test with TotalSatisfaction relative factors

As stated in the previous analysis part, in this correlation part, we will continue exploring the relationship between combined satisfaction (JobSatisFaction & WorkLifeBalance) and other variables, seeking potential indirect fators contributed to employees' attrition choices.

First, we create a correlation table which creates a general idea on all correlations and we will then select potential variable for further correlation tests.

```{r,out.width="100%",fig.align="center",echo=FALSE,message=FALSE}
IBM <-mutate(IBM,combined_satisfaction =JobSatisfaction+WorkLifeBalance)
new_IBM<-select(IBM,-(Attrition),-(BusinessTravel),-(Department),-(EducationField),-(Gender),-(JobRole),-(MaritalStatus),-(OverTime),-(EnvironmentSatisfaction),-(JobSatisfaction),-(WorkLifeBalance),-(TotalSatisfaction),-(RelationshipSatisfaction),-(JobLevel))

library(corrgram)
corrgram(new_IBM,main="Correlogram of IBM data set")

```

In the correlogram, the darker shade implies the higher correlation with each other. The last line indicates all correlations among combined satisfactions and other variables. The factors (with darker shade) need to be inspected and the potential resaons for selecting them are listed below.
```{r,echo=FALSE,message=FALSE}
library(knitr)
Variables<-c("MonthlyIncome","PercentSalaryHike","PerformanceRating","TrainingTimesLastYear","YearsInCurrentRole")
Reasons<-c("Money might be the most direct reason for job satisfaction",
           "Consider about furture development, people may be more happy with high Percent Salary Hike",
           "Motivations for work might decrease due to lower performance rating",
           "Longer training time could be helpful on employees' self-improvement",
           "Long time for repeating the same task might decrease the interest on work")
a<-data.frame(Variables,Reasons)

knitr::kable(a)

```

##1) Monthly Income
```{r}

cor.test(IBM[,"MonthlyIncome"],IBM[,"combined_satisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(0.40687,4)
df<-1468
P_value<-0.6842
Correlation<-round(0.01061867   ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
##The table may not be seen on R markdown here, but can be seen when knited!
```

As shown above, the correlation between Monthly Income and combined satisfaction are around 0.01, there is little relationship between them.However, the increase on monthly income doesn't influence that much as what we expected before. High P-value (around 0.68) indicates monthly income may not be a significant factor for combined satisfaction.

##2) Percent Salary Hike

```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"PercentSalaryHike"],IBM[,"combined_satisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(0.58278,4)
df<-1468
P_value<-0.5601
Correlation<-round(0.01520856  ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

Similar to the previous test, it can be observed that combined satisafaction is possitively but weakly connected with distance from home. In this case, increasing on percent salary hike may have no impact on changing employee's satisfaction.

##3) Performance Rating
```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"PerformanceRating"],IBM[,"combined_satisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round( 0.12842,4)
df<-1468
P_value<-0.8978
Correlation<-round(0.003351649 ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

With correlation value close to zero and 0.89 p-value, we can conclude that there is strongly evidence to reject performance rating as one of the variables for affecting attrition.

##4) Training Times Last Year
```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"TrainingTimesLastYear"],IBM[,"combined_satisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(0.39726,4)
df<-1468
P_value<-0.6912
Correlation<-round(0.01036796 ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

Similar as the privous factor, with 0.01 correlation value, increasing on traning time per year still does not have significant impact on combined satisfaction.

##5) Years In Current Role
```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"YearsInCurrentRole"],IBM[,"combined_satisfaction"])
```

```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(0.9649,4)
df<-1468
P_value<-0.3348
Correlation<-round(0.02517577,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

Compared with other factors tested above, years in current role shows stronger positive correlation with combined satisfaction, which implies the longer employees working on the same role the higher satisfaction they have. 

##Conclusion for the correlation test
As we can see from the above correlation test, years in current role is more relative with combined satisafaction(JobSatisFaction & WorkLifeBalance) compared with others. This implies years in current role may be an indirect variable contributing to employees' attrition choice. However, its correlation value is still not very significant. Therefore the linear regression might not give the a suitable approximation, it may be an approriate choice to apply another regression methods.




# Hypothesis Tests. Cannot Use t-tests as our independent variable is not continuous. Instead, we use regression analysis to determine whether or not the variable is statistically significant.

#First, regressing Attrition on department. Not statistically significant
att_1 <- glm(formula = Attrition ~ Department, data = IBM, family=binomial)

#Second, regressing Attrition on DistanceFromHome
att_2 <- glm(formula = Attrition ~ DistanceFromHome, data = IBM, family=binomial)

#Third, regressing Education on Attrition (NOT DONE YET)
att_3 <- glm(formula = Attrition ~ CONVERTEducation, data = IBM, family=binomial)

#Fourth, regressing Age on Attrition
att_4 <- glm(formula = Attrition ~ Age, data = IBM, family=binomial)

#Fifth, regressing Hourly Rate on Attrition. Not statistically significant
att_5 <- glm(formula = Attrition ~ HourlyRate, data = IBM, family=binomial)

#Sixth, regressing Monthly Income on Attrition.
att_6 <- glm(formula = Attrition ~ MonthlyIncome, data = IBM, family=binomial)

#Seventh, regressing YearsAtCompany on Attrition
att_7 <- glm(formula = Attrition ~ YearsAtCompany, data = IBM, family=binomial)

#Eighth, regressing PercentSalaryHike on Attrition
att_8 <- glm(formula = Attrition ~ PercentSalaryHike, data = IBM, family=binomial)

#Nine, regressing NumCompaniesWorked on Attrition. Not statistically significant.
att_9 <- glm(formula = Attrition ~ NumCompaniesWorked, data = IBM, family=binomial)

#Something.
tot_sat_11 <- glm(formula = Attrition ~ YearsAtCompany, data = IBM, family=binomial)

#Avi, this is the test regression
att_reg <- glm(formula = Attrition ~ DistanceFromHome + Age + MonthlyIncome + YearsAtCompany + NumCompaniesWorked, data = IBM, family=binomial)
summary(att_reg)

>>>>>>> 9cbf55e8d63b23e293a193ca2374544759c17678






# Conclusion 




