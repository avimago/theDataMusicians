---
title: "Factors Impacting Employee Satisfaction"
author: Hai Wen Chen, Avi Mago, William Marshall, Haochen Song, Siddharth Srinivasan
  Swamy, Xuying Zhong
date: "September 25, 2017"
output:
  pdf_document:
    toc: true
    number_sections: true
---
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
IBM <- read.csv("WA_Fn-UseC_-HR-Employee-Attrition.csv")
colnames(IBM)[1] <- "Age"
IBM <- select(IBM, Age:EducationField, EnvironmentSatisfaction:NumCompaniesWorked, OverTime:RelationshipSatisfaction, StockOptionLevel:YearsWithCurrManager)
```
# Introduction
## The relationship between Attrition and Total Satisfaction
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)

IBM <-  mutate(IBM, TotalSatisfaction=EnvironmentSatisfaction+JobSatisfaction+RelationshipSatisfaction+WorkLifeBalance)

library(ggplot2)
Att_TotalSat <- select(IBM, Attrition, TotalSatisfaction)
ggplot(Att_TotalSat,aes(x=Attrition, y=TotalSatisfaction))+geom_boxplot()
```

# Dataset Description and Descriptive Statistics
This dataset described the employees of IBM, providing a total of 1470 observations (employees) and 35 variables (information about the employee). In our analysis, the colomns EmployeeCount and EmployeeNumber are not useful, and the value in Over18 and StandardHour are the same with all employees (Yes and 80 respectively), so we got rid of thses four colomns to make our analysis more efficient. Meanwhile, we added a new colomn called "TotalSatisfaction", which is the sum of EnvironmentSatisfaction,JobSatisfaction,RelationshipSatisfaction and WorkLifeBalance. In addition, the Education colomn uses integer between 1 to 5 to refer to the level of education of this employee, they mean below college, college, bachelor, master, doctor respectively. To catogrize the education level, we change the integer incicating the level in to factor. We did the same thing to JobLevel, StockOptionLevel and TrainingTimeLastYear. Then the variables can be divided into three groups: Personal Information, Job Information, Satisfaction to the Job in Total.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
personal <- data.frame(Variable=c("Age", "DistanceFromHome", "Education",
                                   "EducationField", "Gender", "MaritalStatus",
                                   "NumCompaniesWorked","TotalWorkingYears"),
                       Type=c("integer","integer","factor","factor","factor","factor","integer","integer"),
                       Description=c("The Employee's age", 
                                     "The distance from home to work", 
                                     "Level of education (1 'Below College', 2 'College', 3 'Bachelor', 4 'Master', 5 'Doctor')",
                                     "The subject of the employee's education (Human Resources, Life Sciences, Marketing, Medical, Other, Technical Degree)", 
                                     "Gender of this employee", "Marital status of this employee (Divorced, Married, Single)",
                                     "The number of companies this employee has worked", "Total number of years this employee has worked since graduation"))

kable(personal, caption = "Personal Information")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
jobinfo <- data.frame(Variable=c("Attrition","BusinessTravel","DailyRate","Department","HourlyRate","JobInvolvement",
                                 "JobLevel","JobRole", "MonthlyIncome", "MonthlyRate", "OverTime", "PercentSalaryHike",
                                 "PerformanceRating","StockOptionLevel", "TrainingTimesLastYear","YearsAtCompany",
                                 "YearsInCurrentRole", "YearsSinceLastPromotion","YearsWithCurrManager"),
                      Type=c("factor","factor","integer","factor","integer","factor","factor","factor","integer","integer",
                             "factor","integer","integer","factor","factor","integer","integer","integer","integer"),
                      Description=c("If this employee left the company", "The frquency of business travel", "sth", 
                                    "The department of this employee (Human Resource, Research & Development and Sales)","sth","1 'Low', 2 'Medium', 3 'High', 4 'Very High'","The level of this employee's job","The position of this employee (Sales Executive, Research Scientist, Laboratory Technician, Manufacturing Director, Healthcare Representative, Manager, (Other))", "The salary of this employee","sth", "If this employee works over time (Yes, No)", "The percentage of salary hike", "1 'Low', 2 'Good', 3 'Excellent', 4 'Outstanding'", "The amount of stock this employee process", "The length of training the employee took last year", "The number of years this employee has been in the company", "The number of years this employee has been in this position","The number of years since last promotion", "The number of years this employee has been with current manager"))

kable(jobinfo, caption = "Job Information")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
totals <- data.frame(Variable=c("EnvironmentSatisfaction","JobSatisfaction","RelationshipSatisfaction","WorkLifeBalance",
                                "TotalSatisfaction"),
                     Type=c("integer","integer","integer","integer","integer"),
                     Description=c("Satisfaction to the environment (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "Satisfaction to the job (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "Satisfaction to the relationship (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "The work life balance rate (1 'Bad', 2 'Good', 3 'Better', 4 'Best')",
                                   "The sum of EnvironmentSatisfaction,JobSatisfaction,RelationshipSatisfaction and WorkLifeBalance "))
kable(totals, caption = "Satisfaction to the Job in Total")
```


# Hypothesis 

# Method 

# Analysis

#Converting variables into Factor Variables
IBM$Education<-ordered(IBM$Education,levels=c("1","2","3","4","5"))
IBM$JobSatisfaction<-ordered(IBM$JobSatisfaction,levels=c("1","2","3","4"))
IBM$JobLevel<-ordered(IBM$JobLevel,levels=c("1","2","3","4"))
IBM$JobInvolvement<-ordered(IBM$JobInvolvement,levels=c("1","2","3","4"))
IBM$JobLevel<-ordered(IBM$Joblevel,levels=c("1","2","3","4","5"))
IBM$StockOptionLevel<-ordered(IBM$StockOptionLevel,levels=c("0","1","2","3"))
IBM$TrainingTimesLastYear<-ordered(IBM$TrainingTimesLastYear,levels=c("0","1","2","3","4","5","6"))
IBM$RelationshipSatisfaction<-ordered(IBM$RelationshipSatisfaction,levels=c("1","2","3","4"))
IBM$WorkLifeBalance<-ordered(IBM$WorkLifeBalance,levels=c("1","2","3","4"))


#Plots
#Training Time Last Year (Yes vs No)
ggplot(IBM,aes(x=TrainingTimesLastYear,fill=Attrition))+geom_bar(position="fill")

#Job Satisfaction (Y vs N)
ggplot(IBM,aes(x=JobSatisfaction,fill=Attrition))+geom_bar(position="fill")

#Department wise Attrition (Y vs N)
ggplot(IBM,aes(x=Department,fill=Attrition))+geom_bar(position="fill")

#Monthly Income Density (Y vs N)
ggplot(IBM,aes(x=MonthlyIncome,fill=Attrition))+geom_density(alpha=0.55)

#Years At Company Density (Y vs N)
ggplot(IBM,aes(x=YearsAtCompany,fill=Attrition))+geom_density(adjust=1.5, position="fill")

#Years Since Last Promotion (Y vs N)
ggplot(IBM,aes(x=YearsSinceLastPromotion,fill=Attrition))+geom_bar(position="fill")

#Business Travel (Y vs N)
ggplot(IBM,aes(x=BusinessTravel,fill=Attrition))+geom_bar(position="fill")

#Work Life Balance (Y vs N)
ggplot(IBM,aes(x=WorkLifeBalance,fill=Attrition))+geom_bar(position="fill")


# Hypothesis Tests. Cannot Use t-tests as our independent variable is not continuous. Instead, we use regression analysis to determine whether or not the variable is statistically significant.

#First, regressing Attrition on department. Not statistically significant

Regression Analysis.

The motivation for the following model is to provide the company with a clear indication of the factors significantly contributing to an employee leaving the company. We will then split the model into two: one for those factors the company can directly influence in order to decrease its attrition rate, the other outlaying those which are of a more personal nature and where the company has little or no scope for such interference. That is not to say that those findings have no value, though. The information uncovered here provides the company with a broad insight into the morale across the demographics of its workforce and could provide motivation for the design of programmes or events that subtly engage those with a higher probability of searching for another job.

Hence, we propose a model which treats Attrition as the dependent, or explanatory, variable. Our earlier analysis describes Attrition as a categorical variable and for this reason we used the method of logistic regression to build the model. This method provides the analyst with a percentage chance of an event occuring, where '1' is coded to mean there is a high chance that the employee will leave and '0' to mean the opposite. We use the particular method of logit smoothing to restrict our output between these levels. Incidentally, this also serves as a basis for a scale on which to compare the probability of individual employees leaving. For instance, if the company wanted to know the reasons behind people of or over a certain age leaving the company, then, controlling for age, it is possible to compare whether one employee is likely to leave over another based on their other key characteristics. From here, the company can direct effort into those areas to improve the chances of that employee choosing to stay at the company. 

The process and logic of determining the model is such. First, we use a maximum-likelihood estimation (MLE) to quantify the effect of any particular variable on the probablity of an employee leaving the company. It must be noted that MLE assumes an aspymtotically normal distribution and thus invokes the use of the Wald statistic to test whether or not that particular variable's effect is statistically significant: our null hypothesis is always that the variable has no effect. We set a 95% confidence interval for the model. If the Wald statistic is deemed to be more extreme than this level, then the null hypothesis is rejected and we accept that the alternative hypothesis that there is a statistically significant relationship between those two variables; that the independent variable goes some way in explaining the probablity that an employee leaves. The z-value is then called and calculated to provide the probablilty that the null hypothesis is true in a value names the p-value. If the p-value is below 5% then we reject the null hypothesis.

z score to compute the p value
mean = E(Y)=np
var = np(1-p)



Wald test
z-test

```{r}
att_1 <- glm(formula = Attrition ~ Department, data = IBM, family=binomial)
z.test(x, y = DistanceFromHome, Attrition) #Can't figure out
summary(att_1)
```

#Second, regressing Attrition on DistanceFromHome
att_2 <- glm(formula = Attrition ~ DistanceFromHome, data = IBM, family=binomial)
summary(att_2)

#Third, regressing Education on Attrition (NOT DONE YET)
att_3 <- glm(formula = Attrition ~ CONVERTEducation, data = IBM, family=binomial)
summary(att_3)

#Fourth, regressing Age on Attrition
att_4 <- glm(formula = Attrition ~ Age, data = IBM, family=binomial)
summary(att_4)

#Fifth, regressing Hourly Rate on Attrition. Not statistically significant
att_5 <- glm(formula = Attrition ~ HourlyRate, data = IBM, family=binomial)
summary(att_1)

#Sixth, regressing Monthly Income on Attrition.
att_6 <- glm(formula = Attrition ~ MonthlyIncome, data = IBM, family=binomial)
summary(att_6)

#Seventh, regressing YearsAtCompany on Attrition
att_7 <- glm(formula = Attrition ~ YearsAtCompany, data = IBM, family=binomial)
summary(att_7)

#Eighth, regressing PercentSalaryHike on Attrition
att_8 <- glm(formula = Attrition ~ PercentSalaryHike, data = IBM, family=binomial)
summary(att_1)

#Nine, regressing NumCompaniesWorked on Attrition. Not statistically significant.
att_9 <- glm(formula = Attrition ~ NumCompaniesWorked, data = IBM, family=binomial)
summary(att_1)

#Something.
tot_sat_11 <- glm(formula = Attrition ~ YearsAtCompany, data = IBM, family=binomial)
summary(att_1)

#Avi, this is the test regression
att_reg <- glm(formula = Attrition ~ DistanceFromHome + Age + MonthlyIncome + YearsAtCompany + NumCompaniesWorked, data = IBM, family=binomial)
summary(att_reg)


# Conclusion 



