---
title: "Factors Impacting Employee Satisfaction"
author: Hai Wen Chen, Avi Mago, William Marshall, Haochen Song, Siddharth Srinivasan
  Swamy, Xuying Zhong
date: "September 25, 2017"
output:
  html_document:
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
---
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
IBM <- read.csv("WA_Fn-UseC_-HR-Employee-Attrition.csv")
colnames(IBM)[1] <- "Age"
IBM <- select(IBM, Age:EducationField, EnvironmentSatisfaction:NumCompaniesWorked, OverTime:RelationshipSatisfaction, StockOptionLevel:YearsWithCurrManager)
```
# Introduction
## The relationship between Attrition and Total Satisfaction
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)

IBM <-  mutate(IBM, TotalSatisfaction=EnvironmentSatisfaction+JobSatisfaction+RelationshipSatisfaction+WorkLifeBalance)

library(ggplot2)
Att_TotalSat <- select(IBM, Attrition, TotalSatisfaction)
ggplot(Att_TotalSat,aes(x=Attrition, y=TotalSatisfaction))+geom_boxplot()
```

# Dataset Description and Descriptive Statistics
This dataset described the employees of IBM, providing a total of 1470 observations (employees) and 35 variables (information about the employee). In our analysis, the colomns EmployeeCount and EmployeeNumber are not useful, and the value in Over18 and StandardHour are the same with all employees (Yes and 80 respectively), so we got rid of thses four colomns to make our analysis more efficient. Meanwhile, we added a new colomn called "TotalSatisfaction", which is the sum of EnvironmentSatisfaction,JobSatisfaction,RelationshipSatisfaction and WorkLifeBalance. In addition, the Education colomn uses integer between 1 to 5 to refer to the level of education of this employee, they mean below college, college, bachelor, master, doctor respectively. To catogrize the education level, we change the integer incicating the level in to factor. We did the same thing to JobLevel, StockOptionLevel and TrainingTimeLastYear. Then the variables can be divided into three groups: Personal Information, Job Information, Satisfaction to the Job in Total.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
personal <- data.frame(Variable=c("Age", "DistanceFromHome", "Education",
                                   "EducationField", "Gender", "MaritalStatus",
                                   "NumCompaniesWorked","TotalWorkingYears"),
                       Type=c("integer","integer","factor","factor","factor","factor","integer","integer"),
                       Description=c("The Employee's age", 
                                     "The distance from home to work", 
                                     "Level of education (1 'Below College', 2 'College', 3 'Bachelor', 4 'Master', 5 'Doctor')",
                                     "The subject of the employee's education (Human Resources, Life Sciences, Marketing, Medical, Other, Technical Degree)", 
                                     "Gender of this employee", "Marital status of this employee (Divorced, Married, Single)",
                                     "The number of companies this employee has worked", "Total number of years this employee has worked since graduation"))

kable(personal, caption = "Personal Information")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
jobinfo <- data.frame(Variable=c("Attrition","BusinessTravel","DailyRate","Department","HourlyRate","JobInvolvement",
                                 "JobLevel","JobRole", "MonthlyIncome", "MonthlyRate", "OverTime", "PercentSalaryHike",
                                 "PerformanceRating","StockOptionLevel", "TrainingTimesLastYear","YearsAtCompany",
                                 "YearsInCurrentRole", "YearsSinceLastPromotion","YearsWithCurrManager"),
                      Type=c("factor","factor","integer","factor","integer","factor","factor","factor","integer","integer",
                             "factor","integer","integer","factor","factor","integer","integer","integer","integer"),
                      Description=c("If this employee left the company", "The frquency of business travel", "sth", 
                                    "The department of this employee (Human Resource, Research & Development and Sales)","sth","1 'Low', 2 'Medium', 3 'High', 4 'Very High'","The level of this employee's job","The position of this employee (Sales Executive, Research Scientist, Laboratory Technician, Manufacturing Director, Healthcare Representative, Manager, (Other))", "The salary of this employee","sth", "If this employee works over time (Yes, No)", "The percentage of salary hike", "1 'Low', 2 'Good', 3 'Excellent', 4 'Outstanding'", "The amount of stock this employee process", "The length of training the employee took last year", "The number of years this employee has been in the company", "The number of years this employee has been in this position","The number of years since last promotion", "The number of years this employee has been with current manager"))

kable(jobinfo, caption = "Job Information")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
totals <- data.frame(Variable=c("EnvironmentSatisfaction","JobSatisfaction","RelationshipSatisfaction","WorkLifeBalance",
                                "TotalSatisfaction"),
                     Type=c("integer","integer","integer","integer","integer"),
                     Description=c("Satisfaction to the environment (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "Satisfaction to the job (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "Satisfaction to the relationship (1 'Low', 2 'Medium', 3 'High', 4 'Very High')",
                                   "The work life balance rate (1 'Bad', 2 'Good', 3 'Better', 4 'Best')",
                                   "The sum of EnvironmentSatisfaction,JobSatisfaction,RelationshipSatisfaction and WorkLifeBalance "))
kable(totals, caption = "Satisfaction to the Job in Total")
```





# Hypothesis 

# Method 

<<<<<<< HEAD
## Analysis 

# Correlation Test with TotalSatisfaction relative factors
In this part, in order to seek what is the suitable regression function, we are going to find out how does each potential variables correlated with total satisfaction for employees. The factors need to be inspected and the resaons of selecting them are listed below.
```{r,echo=FALSE,message=FALSE}
library(knitr)
Variables<-c("Age","MonthlyIncom","DistanceFromHome","PercentSalaryHike","YearsInCurrentRole")
Reasons<-c("Expectations of employees may differ according to their ages",
           "Money might be the most direct reason for job satisfaction",
           "Time taken travel to work may affect total satisfaction",
           "Consider about furture development, people may be more happy with high Percent Salary Hike",
           "Long time for repeating the same task might decrease the interest on work")
a<-data.frame(Variables,Reasons)

knitr::kable(a)

```


###1) Age
```{r}
cor.test(IBM[,"Age"],IBM[,"TotalSatisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(0.91674,4)
df<-1468
P_value<-0.3594
Correlation<-round(0.02391978  ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
##The table may not be seen on R markdown here, but can be seen when knited!
```

As shown above, the correlation between age and total satisfaction are around 0.024, there is little relationship between them. Older employees might be more used to the company environment and youger emplloyees seems have higher expectation.

###2) MonthlyIncome

```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"MonthlyIncome"],IBM[,"TotalSatisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(-0.66132,4)
df<-1468
P_value<-0.5085
Correlation<-round(0.01725778 ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

Similar to age, although there is evidence shown on p-value that the null hypothesis is significant, the 0.017 correlation value still implies a little positive relationship between monthly income and satisfaction. However, the increase on monthly income doesn't influence that much as what we expected before.

###3) Distance from Home
```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"DistanceFromHome"],IBM[,"TotalSatisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(-0.63048,4)
df<-1468
P_value<-0.5285
Correlation<-round(-0.01645315  ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

It can be observed from the above test that total satisafaction is negatively and weakly connected with distance from home. In this case, time cost on travel to work is not a reason to be considered for employees when measuring about satisafaction level.

###4) Percent Salary Hike
```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"PercentSalaryHike"],IBM[,"TotalSatisfaction"])
```
```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(-1.1118,4)
df<-1468
P_value<-0.2664
Correlation<-round(-0.02900669 ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

Similar as the privous factor, with -0.029 correlation value, increasing on percent salary hike may have no impact on changing employee's satisfaction.

###5) Years In Current Role
```{r,echo=FALSE,message=FALSE}
cor.test(IBM[,"YearsInCurrentRole"],IBM[,"TotalSatisfaction"])
```

```{r,echo=FALSE,message=FALSE}
Test_statistic<-round(0.68209,4)
df<-1468
P_value<-0.4953
Correlation<-round(0.01779959 ,4)
corr<-data.frame(Test_statistic,df,P_value,Correlation)
library(knitr)
knitr::kable(corr,caption="Summary")
```

Different from what we expected before, years in current role shows weak but positive correlation with total satisfaction, which implies the longer employees working on the same role the higher satisfaction they have. 

###Conclusion for the correlation test
As we can see from the above test, age, monthly income and years in current role are higher relative with total satisafaction compared with other two factors. However, their correlation value are still not very significant. Therefore the linear regression might not give the a suitable approximation, it may be an approriate choice to apply another regression methods.



=======
# Analysis

#Converting variables into Factor Variables
IBM$Education<-ordered(IBM$Education,levels=c("1","2","3","4","5"))
IBM$JobSatisfaction<-ordered(IBM$JobSatisfaction,levels=c("1","2","3","4"))
IBM$JobLevel<-ordered(IBM$JobLevel,levels=c("1","2","3","4"))
IBM$JobInvolvement<-ordered(IBM$JobInvolvement,levels=c("1","2","3","4"))
IBM$JobLevel<-ordered(IBM$Joblevel,levels=c("1","2","3","4","5"))
IBM$StockOptionLevel<-ordered(IBM$StockOptionLevel,levels=c("0","1","2","3"))
IBM$TrainingTimesLastYear<-ordered(IBM$TrainingTimesLastYear,levels=c("0","1","2","3","4","5","6"))
IBM$RelationshipSatisfaction<-ordered(IBM$RelationshipSatisfaction,levels=c("1","2","3","4"))
IBM$WorkLifeBalance<-ordered(IBM$WorkLifeBalance,levels=c("1","2","3","4"))


#Plots
#Training Time Last Year (Yes vs No)
ggplot(IBM,aes(x=TrainingTimesLastYear,fill=Attrition))+geom_bar(position="fill")

#Job Satisfaction (Y vs N)
ggplot(IBM,aes(x=JobSatisfaction,fill=Attrition))+geom_bar(position="fill")

#Department wise Attrition (Y vs N)
ggplot(IBM,aes(x=Department,fill=Attrition))+geom_bar(position="fill")

#Monthly Income Density (Y vs N)
ggplot(IBM,aes(x=MonthlyIncome,fill=Attrition))+geom_density(alpha=0.55)

#Years At Company Density (Y vs N)
ggplot(IBM,aes(x=YearsAtCompany,fill=Attrition))+geom_density(adjust=1.5, position="fill")

#Years Since Last Promotion (Y vs N)
ggplot(IBM,aes(x=YearsSinceLastPromotion,fill=Attrition))+geom_bar(position="fill")

#Business Travel (Y vs N)
ggplot(IBM,aes(x=BusinessTravel,fill=Attrition))+geom_bar(position="fill")

#Work Life Balance (Y vs N)
ggplot(IBM,aes(x=WorkLifeBalance,fill=Attrition))+geom_bar(position="fill")


# Hypothesis Tests. Cannot Use t-tests as our independent variable is not continuous. Instead, we use regression analysis to determine whether or not the variable is statistically significant.

#First, regressing Attrition on department. Not statistically significant
att_1 <- glm(formula = Attrition ~ Department, data = IBM, family=binomial)

#Second, regressing Attrition on DistanceFromHome
att_2 <- glm(formula = Attrition ~ DistanceFromHome, data = IBM, family=binomial)

#Third, regressing Education on Attrition (NOT DONE YET)
att_3 <- glm(formula = Attrition ~ CONVERTEducation, data = IBM, family=binomial)

#Fourth, regressing Age on Attrition
att_4 <- glm(formula = Attrition ~ Age, data = IBM, family=binomial)

#Fifth, regressing Hourly Rate on Attrition. Not statistically significant
att_5 <- glm(formula = Attrition ~ HourlyRate, data = IBM, family=binomial)

#Sixth, regressing Monthly Income on Attrition.
att_6 <- glm(formula = Attrition ~ MonthlyIncome, data = IBM, family=binomial)

#Seventh, regressing YearsAtCompany on Attrition
att_7 <- glm(formula = Attrition ~ YearsAtCompany, data = IBM, family=binomial)

#Eighth, regressing PercentSalaryHike on Attrition
att_8 <- glm(formula = Attrition ~ PercentSalaryHike, data = IBM, family=binomial)

#Nine, regressing NumCompaniesWorked on Attrition. Not statistically significant.
att_9 <- glm(formula = Attrition ~ NumCompaniesWorked, data = IBM, family=binomial)

#Something.
tot_sat_11 <- glm(formula = Attrition ~ YearsAtCompany, data = IBM, family=binomial)

#Avi, this is the test regression
att_reg <- glm(formula = Attrition ~ DistanceFromHome + Age + MonthlyIncome + YearsAtCompany + NumCompaniesWorked, data = IBM, family=binomial)
summary(att_reg)

>>>>>>> 9cbf55e8d63b23e293a193ca2374544759c17678


# Conclusion 



